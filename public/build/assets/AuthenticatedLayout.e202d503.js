import{A as L}from"./ApplicationLogo.13c20baa.js";import{j as q,q as D,l as y,i as N,o as b,g as v,d as s,r as p,h as S,v as $,a as l,w as a,n as f,b as g,T as I,c as k,L as x,e as h,t as w,k as B}from"./app.df7a48ba.js";import{m as E}from"./mqtt.min.77c8ccfe.js";const M={class:"relative"},O={__name:"Dropdown",props:{align:{default:"right"},width:{default:"48"},contentClasses:{default:()=>["py-1","bg-white"]}},setup(o){const t=o,e=r=>{c.value&&r.key==="Escape"&&(c.value=!1)};q(()=>document.addEventListener("keydown",e)),D(()=>document.removeEventListener("keydown",e));const n=y(()=>({48:"w-48"})[t.width.toString()]),d=y(()=>t.align==="left"?"origin-top-left left-0":t.align==="right"?"origin-top-right right-0":"origin-top"),c=N(!1);return(r,u)=>(b(),v("div",M,[s("div",{onClick:u[0]||(u[0]=i=>c.value=!c.value)},[p(r.$slots,"trigger")]),S(s("div",{class:"fixed inset-0 z-40",onClick:u[1]||(u[1]=i=>c.value=!1)},null,512),[[$,c.value]]),l(I,{"enter-active-class":"transition ease-out duration-200","enter-from-class":"transform opacity-0 scale-95","enter-to-class":"transform opacity-100 scale-100","leave-active-class":"transition ease-in duration-75","leave-from-class":"transform opacity-100 scale-100","leave-to-class":"transform opacity-0 scale-95"},{default:a(()=>[S(s("div",{class:f(["absolute z-50 mt-2 rounded-md shadow-lg",[g(n),g(d)]]),style:{display:"none"},onClick:u[2]||(u[2]=i=>c.value=!1)},[s("div",{class:f(["rounded-md ring-1 ring-black ring-opacity-5",o.contentClasses])},[p(r.$slots,"content")],2)],2),[[$,c.value]])]),_:3})]))}},R={__name:"DropdownLink",setup(o){return(t,e)=>(b(),k(g(x),{class:"block w-full px-4 py-2 text-left text-sm leading-5 text-gray-700 hover:bg-gray-100 focus:outline-none focus:bg-gray-100 transition duration-150 ease-in-out"},{default:a(()=>[p(t.$slots,"default")]),_:3}))}},_={__name:"NavLink",props:["href","active"],setup(o){const t=o,e=y(()=>t.active?"inline-flex items-center px-1 pt-1 border-b-2 border-indigo-400 text-sm font-medium leading-5 text-gray-900 focus:outline-none focus:border-indigo-700 transition duration-150 ease-in-out":"inline-flex items-center px-1 pt-1 border-b-2 border-transparent text-sm font-medium leading-5 text-gray-500 hover:text-gray-700 hover:border-gray-300 focus:outline-none focus:text-gray-700 focus:border-gray-300 transition duration-150 ease-in-out");return(n,d)=>(b(),k(g(x),{href:o.href,class:f(g(e))},{default:a(()=>[p(n.$slots,"default")]),_:3},8,["href","class"]))}},C={__name:"ResponsiveNavLink",props:["href","active"],setup(o){const t=o,e=y(()=>t.active?"block w-full pl-3 pr-4 py-2 border-l-4 border-indigo-400 text-left text-base font-medium text-indigo-700 bg-indigo-50 focus:outline-none focus:text-indigo-800 focus:bg-indigo-100 focus:border-indigo-700 transition duration-150 ease-in-out":"block w-full pl-3 pr-4 py-2 border-l-4 border-transparent text-left text-base font-medium text-gray-600 hover:text-gray-800 hover:bg-gray-50 hover:border-gray-300 focus:outline-none focus:text-gray-800 focus:bg-gray-50 focus:border-gray-300 transition duration-150 ease-in-out");return(n,d)=>(b(),k(g(x),{href:o.href,class:f(g(e))},{default:a(()=>[p(n.$slots,"default")]),_:3},8,["href","class"]))}},U={components:{},data(){return{connection:{protocol:"ws",host:"demo.dkproject.store",port:9001,endpoint:"",clean:!0,connectTimeout:30*1e3,reconnectPeriod:4e3,clientId:"emqx_vue_"+Math.random().toString(16).substring(2,8),username:"danielkeung",password:"danielkeung123"},subscription:{topic:"table/request",qos:0},subscription2:{topic:"table/status",qos:0},publish:{topic:"table/response",qos:0,payload:""},publish2:{topic:"table/status",qos:0,payload:'{ "msg": "test" }'},receiveNews:"",qosList:[0,1,2],client:{connected:!1},subscribeSuccess:!1,connecting:!1,retryTimes:0,InfoListTmp2:[]}},unmounted(){console.log("unmounted"),this.doUnSubscribe(this.subscription),this.doUnSubscribe(this.subscription2)},mounted(){console.log("mounted"),this.initData(),this.createConnection(),this.doSubscribe(this.subscription),this.doSubscribe(this.subscription2)},methods:{initData(){this.client={connected:!1},this.retryTimes=0,this.connecting=!1,this.subscribeSuccess=!1},handleOnReConnect(){if(this.retryTimes+=1,this.retryTimes>5)try{this.client.end(),this.initData(),this.$message.error("Connection maxReconnectTimes limit, stop retry")}catch(o){this.$message.error(o.toString())}},createConnection(){try{this.connecting=!0;const{protocol:o,host:t,port:e,endpoint:n,...d}=this.connection,c=`${o}://${t}:${e}${n}`;this.client=E.exports.connect(c,d),this.client.on&&(this.client.on("connect",()=>{this.connecting=!1,this.client.connected=!0,console.log("Connection succeeded!")}),this.client.on("reconnect",this.handleOnReConnect),this.client.on("error",r=>{console.log("Connection failed",r)}),this.client.on("message",(r,u)=>{this.receiveNews="",this.receiveNews=JSON.parse(this.receiveNews.concat(u)),console.log(`Received message ${u} from topic ${r}`),r=="table/request"&&axios.post("/productSuggest",{no_of_ppl:this.receiveNews.no_of_ppl,rest_id:this.receiveNews.rest_id}).then(i=>{this.getSuggest(!0)}),r=="table/status"&&axios.post("/getTableByRestIdTableNo",{table_no:this.receiveNews.table_no,rest_id:this.receiveNews.rest_id}).then(i=>{axios.post("/updateStatusById",{table_id:i.data.table[0].table_id,table_no:i.data.table[0].table_no,rest_id:i.data.table[0].rest_id,capacity:i.data.table[0].capacity,table_x:i.data.table[0].table_x,table_y:i.data.table[0].table_y,status:this.receiveNews.status,robot_id:i.data.table[0].robot_id}).then(m=>{console.log(m),this.InfoListTmp2.push({table_id:i.data.table[0].table_id,table_no:i.data.table[0].table_no,rest_id:i.data.table[0].rest_id,capacity:i.data.table[0].capacity,table_x:i.data.table[0].table_x,table_y:i.data.table[0].table_y,status:this.receiveNews.status,robot_id:i.data.table[0].robot_id})}),this.receiveNews.status=="ACTIVE"&&axios.post("/getSuggestByTableId",{table_id:i.data.table[0].table_id}).then(m=>{m.data.suggest[0],axios.post("/updateStatus",{suggest_id:m.data.suggest[0].suggest_id,no_of_ppl:m.data.suggest[0].no_of_ppl,status:"PENDING",table_id:m.data.suggest[0].table_id}).then(T=>{console.log(T)})})})}))}catch(o){this.connecting=!1,console.log("createConnection error"),this.handleOnReConnect(),console.log("mqtt.connect error",o)}},doSubscribe(o){const{topic:t,qos:e}=o;this.client.subscribe(t,{qos:e},(n,d)=>{if(n){console.log("Subscribe to topics error",n);return}this.subscribeSuccess=!0,console.log("Subscribe to topics res",d)})},doUnSubscribe(o){const{topic:t}=o;console.log("doUnSubscribe"),this.client.unsubscribe(t,e=>{e&&console.log("Unsubscribe error",e)})},doPublish(o,t,e,n){let d='{ "re_no":"'+o+'","status":"'+e+'","table_no":"'+n+'"}';const{topic:c,qos:r,payload:u}=this.publish;this.client.publish(t,d,{qos:r},i=>{i&&console.log("Publish error",i)})},destroyConnection(){if(this.client.connected)try{this.client.end(!1,()=>{this.initData(),console.log("Successfully disconnected!")})}catch(o){console.log("Disconnect failed",o.toString())}},getSuggest(o=!1){axios.get("/getSuggest").then(t=>{for(let e=0;e<t.data.suggests.length;e++)axios.post("/getTableById",{table_id:t.data.suggests[e].table_id}).then(n=>{console.log(n)}),e==t.data.suggests.length-1&&o&&this.doPublish(t.data.suggests[e].suggest_id.toString(),"table/response","PENDING","")})}}},V={class:"min-h-screen bg-gray-100"},j={class:"bg-white border-b border-gray-100"},P={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},z={class:"flex justify-between h-16"},A={class:"flex"},G={class:"shrink-0 flex items-center"},J={class:"hidden space-x-8 sm:-my-px sm:ml-10 sm:flex"},F={class:"hidden sm:flex sm:items-center sm:ml-6"},H={class:"ml-3 relative"},K={class:"inline-flex rounded-md"},Q={type:"button",class:"inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-gray-500 bg-white hover:text-gray-700 focus:outline-none transition ease-in-out duration-150"},W=s("svg",{class:"ml-2 -mr-0.5 h-4 w-4",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[s("path",{"fill-rule":"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z","clip-rule":"evenodd"})],-1),X={class:"-mr-2 flex items-center sm:hidden"},Y={class:"h-6 w-6",stroke:"currentColor",fill:"none",viewBox:"0 0 24 24"},Z={class:"pt-2 pb-3 space-y-1"},ee={class:"pt-4 pb-1 border-t border-gray-200"},te={class:"px-4"},se={class:"font-medium text-base text-gray-800"},oe={class:"font-medium text-sm text-gray-500"},ie={class:"mt-3 space-y-1"},ne={key:0,class:"bg-white shadow"},ae={class:"max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8"},de={__name:"AuthenticatedLayout",setup(o){const t=N(!1);return(e,n)=>(b(),v("div",null,[l(U),s("div",V,[s("nav",j,[s("div",P,[s("div",z,[s("div",A,[s("div",G,[l(g(x),{href:e.route("dashboard")},{default:a(()=>[l(L,{class:"block h-9 w-auto fill-current text-gray-800"})]),_:1},8,["href"])]),s("div",J,[l(_,{href:e.route("dashboard"),active:e.route().current("dashboard")},{default:a(()=>[h(" Introduction ")]),_:1},8,["href","active"]),l(_,{href:e.route("tableViews.index"),active:e.route().current("tableViews.index")},{default:a(()=>[h(" Overview ")]),_:1},8,["href","active"]),l(_,{href:e.route("suggests.index"),active:e.route().current("suggests.index")},{default:a(()=>[h(" Suggestions ")]),_:1},8,["href","active"]),l(_,{href:e.route("tables.index"),active:e.route().current("tables.index")},{default:a(()=>[h(" Tables ")]),_:1},8,["href","active"])])]),s("div",F,[s("div",H,[l(O,{align:"right",width:"48"},{trigger:a(()=>[s("span",K,[s("button",Q,[h(w(e.$page.props.auth.user.name)+" ",1),W])])]),content:a(()=>[l(R,{href:e.route("logout"),method:"post",as:"button"},{default:a(()=>[h(" Log Out ")]),_:1},8,["href"])]),_:1})])]),s("div",X,[s("button",{onClick:n[0]||(n[0]=d=>t.value=!t.value),class:"inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:bg-gray-100 focus:text-gray-500 transition duration-150 ease-in-out"},[(b(),v("svg",Y,[s("path",{class:f({hidden:t.value,"inline-flex":!t.value}),"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 6h16M4 12h16M4 18h16"},null,2),s("path",{class:f({hidden:!t.value,"inline-flex":t.value}),"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"},null,2)]))])])])]),s("div",{class:f([{block:t.value,hidden:!t.value},"sm:hidden"])},[s("div",Z,[l(C,{href:e.route("dashboard"),active:e.route().current("dashboard")},{default:a(()=>[h(" Dashboard ")]),_:1},8,["href","active"])]),s("div",ee,[s("div",te,[s("div",se,w(e.$page.props.auth.user.name),1),s("div",oe,w(e.$page.props.auth.user.email),1)]),s("div",ie,[l(C,{href:e.route("logout"),method:"post",as:"button"},{default:a(()=>[h(" Log Out ")]),_:1},8,["href"])])])],2)]),e.$slots.header?(b(),v("header",ne,[s("div",ae,[p(e.$slots,"header")])])):B("",!0),s("main",null,[p(e.$slots,"default")])])]))}};export{de as _,U as a};

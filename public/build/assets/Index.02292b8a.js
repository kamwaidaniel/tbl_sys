import{o as a,g as u,F as p,x as f,n as h,t as m,d as c,D as b,a as _,h as y,E as w,G as S,I as x}from"./app.df7a48ba.js";import{_ as g}from"./_plugin-vue_export-helper.cdc0426e.js";import{e as C}from"./vue-basic-alert.esm.a6fa098a.js";import{m as k}from"./mqtt.min.77c8ccfe.js";const N={props:["selfValue"],data(){return{value:"",keys:[...Array(10).keys()],keyTheme:"btn-keyboard",buttonTheme:"btn-danger"}},methods:{press(e){this.value=`${this.value}${e}`},clear(e){e==="all"?this.value="":this.value=this.value.substring(0,this.value.length-1)},enter(){this.value="enter"}},watch:{value(){this.$emit("pressed",this.value)},selfValue(){this.value=this.selfValue}},created(){}},T={class:"vuertual-numeric-keyboard bg-light rounded border p-3"},I=["onClick"];function $(e,t,i,l,s,r){return a(),u("div",T,[(a(!0),u(p,null,f(s.keys,o=>(a(),u("button",{key:o,onClick:d=>r.press(o),class:h(["btn btn-lg shadow-none",s.keyTheme])},m(o),11,I))),128)),c("button",{class:h(["btn btn-lg shadow-none",s.buttonTheme]),onClick:t[0]||(t[0]=o=>r.clear())},"\u2190",2),c("button",{class:h(["btn btn-lg shadow-none",s.buttonTheme]),onClick:t[1]||(t[1]=o=>r.enter())},"Yes",2)])}const O=g(N,[["render",$],["__scopeId","data-v-98f6b2bf"]]);const P={components:{Keyboard:O,VueBasicAlert:C},data(){return{arrayOfObjects:[],value:[],valueLists:[],rest_id:"",connection:{protocol:"ws",host:"demo.dkproject.store",port:9001,endpoint:"",clean:!0,connectTimeout:30*1e3,reconnectPeriod:4e3,clientId:"emqx_vue_"+Math.random().toString(16).substring(2,8),username:"danielkeung",password:"danielkeung123"},subscription:{topic:"table/response",qos:0},publish:{topic:"table/request",qos:0,payload:""},receiveNews:"",qosList:[0,1,2],client:{connected:!1},subscribeSuccess:!1,connecting:!1,retryTimes:0}},unmounted(){console.log("unmounted"),this.doUnSubscribe(this.subscription)},mounted(){console.log("mounted"),this.initData(),this.createConnection(),this.doSubscribe(this.subscription)},created(){axios.get("/getRest").then(e=>{for(let t=0;t<e.data.rests.length;t++)console.log(e.data.rests[t].rest_id),this.arrayOfObjects.push({name:e.data.rests[t].rest_id});console.log(this.arrayOfObjects)})},methods:{initData(){this.client={connected:!1},this.retryTimes=0,this.connecting=!1,this.subscribeSuccess=!1},onChange(e){document.getElementById("dropdown").disabled=!0,this.rest_id=e},handleOnReConnect(){if(this.retryTimes+=1,this.retryTimes>5)try{this.client.end(),this.initData(),this.$message.error("Connection maxReconnectTimes limit, stop retry")}catch(e){this.$message.error(e.toString())}},createConnection(){try{this.connecting=!0;const{protocol:e,host:t,port:i,endpoint:l,...s}=this.connection,r=`${e}://${t}:${i}${l}`;this.client=k.exports.connect(r,s),this.client.on&&(this.client.on("connect",()=>{this.connecting=!1,this.client.connected=!0,console.log("Connection succeeded!")}),this.client.on("reconnect",this.handleOnReConnect),this.client.on("error",o=>{console.log("Connection failed",o)}),this.client.on("message",(o,d)=>{if(console.log(`Received message ${d} from topic ${o}`),this.receiveNews="",this.receiveNews=JSON.parse(this.receiveNews.concat(d)),o=="table/response"){let n="";this.receiveNews.status=="READY"&&(n=this.receiveNews.re_no+" is Ready. Your table no is "+this.receiveNews.table_no+". "),this.receiveNews.status=="PENDING"&&(n="Your reservation no. is "+this.receiveNews.re_no),this.$refs.alert.showAlert("success",n,"Information!","",{iconSize:500,iconType:"solid",position:"top left"})}}))}catch(e){this.connecting=!1,console.log("createConnection error"),this.handleOnReConnect(),console.log("mqtt.connect error",e)}},doPublish(e){if(e=="enter"){if(this.valueLists.length>0){let t=this.valueLists[this.valueLists.length-1];if(this.rest_id){let i='{ "no_of_ppl":'+t+',"rest_id":"'+this.rest_id+'"}';const{topic:l,qos:s,payload:r}=this.publish;this.client.publish(l,i,{qos:s},o=>{this.valueLists=[],o&&console.log("Publish error",o)})}else this.$refs.alert.showAlert("error","Please select the restaurant.","Error!","Error 404",{iconSize:100,iconType:"solid",position:"top left"})}this.value=""}else this.valueLists.push(e)},doSubscribe(e){const{topic:t,qos:i}=e;this.client.subscribe(t,{qos:i},(l,s)=>{if(l){console.log("Subscribe to topics error",l);return}this.subscribeSuccess=!0,console.log("Subscribe to topics res",s)})},doUnSubscribe(e){const{topic:t}=e;console.log("doUnSubscribe"),this.client.unsubscribe(t,i=>{i&&console.log("Unsubscribe error",i)})},destroyConnection(){if(this.client.connected)try{this.client.end(!1,()=>{this.initData(),console.log("Successfully disconnected!")})}catch(e){console.log("Disconnect failed",e.toString())}}}},v=e=>(S("data-v-f35e3bc7"),e=e(),x(),e),D={class:"container"},q=v(()=>c("option",{value:"Please select restaurant",selected:""},"Please select restaurant",-1)),V=["value"],L={class:"form-group mt-5"},R=v(()=>c("label",{for:"txtBox"},[c("h5",null,"Please input the number of guest.")],-1));function B(e,t,i,l,s,r){const o=b("vue-basic-alert"),d=b("Keyboard");return a(),u(p,null,[_(o,{duration:500,closeIn:8e3,ref:"alert"},null,512),c("div",D,[c("select",{id:"dropdown",style:{"margin-top":"20%"},onChange:t[0]||(t[0]=n=>r.onChange(n.target.value))},[q,(a(!0),u(p,null,f(s.arrayOfObjects,n=>(a(),u("option",{value:n.name},m(n.name),9,V))),256))],32),c("div",L,[R,y(c("input",{type:"text",class:"form-control","onUpdate:modelValue":t[1]||(t[1]=n=>s.value=n),id:"txtBox",placeholder:"Press any button"},null,512),[[w,s.value]])]),_(d,{onPressed:t[2]||(t[2]=n=>{s.value=n,r.doPublish(n)}),selfValue:s.value},null,8,["selfValue"])])],64)}const K=g(P,[["render",B],["__scopeId","data-v-f35e3bc7"]]);export{K as default};
